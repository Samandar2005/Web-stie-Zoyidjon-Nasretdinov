!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).reasons={})}(this,(function(e){"use strict";const n=Math.pow(36,9),t=35*n-1;let i={handler:"/aer-reasons/",service:"",details:{pkg:"0.22.1"},payload:{}};let r=[];function a(e){const{payload:n}=i,t=Object.assign(Object.assign({},e),{ts:(new Date).toISOString(),payload:Object.assign(Object.assign({},n),e.payload)});r.push(t)}let o=0;function s(){if(!r.length)return;const{handler:e,service:n,details:t}=i,a={version:1,details:t,messages:r,messageIndex:o};if(o++,!a.messages.length)return;a.messages=function(e){const n=e.filter((({code:e})=>"PERF"===e));if(n.length<=1)return e;const t=n.reduce(((e,n)=>({perf:Object.assign(Object.assign({},e.perf),n.perf),payload:Object.assign(Object.assign({},e.payload),n.payload)})),{});return[...e.filter((({code:e})=>"PERF"!==e)),Object.assign({code:"PERF",message:""},t)]}(a.messages);const s=e+n,c=JSON.stringify(a);!/\sWindVane\//.test(window.navigator.userAgent)&&"undefined"!=typeof navigator&&navigator.sendBeacon?navigator.sendBeacon(s,c):fetch(s,{method:"POST",mode:"cors",body:c}).catch((e=>{console.error("Couldn't send a message to reason server",e)})),r=[]}function c(e){if(!e||!window.PerformanceObserver)return;const n=[];new PerformanceObserver((e=>{e.getEntries().filter((({initiatorType:e})=>"img"===e)).forEach((({duration:e,name:t})=>{const i=(e=>{if(!e)return null;let n="other",t="unknown";const i=new URL(e),r="alicdn.com"===i.hostname.split(".").slice(-2).join("."),a=i.pathname.split("."),o=a[a.length-1].toLowerCase();if(["gif","jpg","png","webp","jpeg","svg"].includes(o)?n=o:o||(n="unknown"),r){const e=new RegExp(/_(\d{2,3}x\d{2,3})/g),n=i.pathname.match(e);t=n?n[n.length-1].substring(1):"full"}return{format:n,size:t}})(t);if(!i)return;const r=(a=e,(null===(o=[100,300,1e3,3e3,1e4,3e4].find((e=>e>=a)))||void 0===o?void 0:o.toString())||"Inf");var a,o;const s=n.find((({format:e,size:n,bucket:t})=>e===i.format&&n===i.size&&t===r));s?s.count+=1:n.push({format:i.format,size:i.size,bucket:r,count:1})}))})).observe({type:"resource",buffered:!0}),window.addEventListener("beforeunload",(()=>{a({code:"PERF",message:"",perf:{imgs_data:n}})}))}var d,u,f,l,m=function(e,n){return{name:e,value:void 0===n?-1:n,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},v=function(e,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var t=new PerformanceObserver((function(e){return e.getEntries().map(n)}));return t.observe({type:e,buffered:!0}),t}}catch(e){}},p=function(e,n){var t=function t(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),n&&(removeEventListener("visibilitychange",t,!0),removeEventListener("pagehide",t,!0)))};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},g=function(e){addEventListener("pageshow",(function(n){n.persisted&&e(n)}),!0)},h=function(e,n,t){var i;return function(r){n.value>=0&&(r||t)&&(n.delta=n.value-(i||0),(n.delta||void 0===i)&&(i=n.value,e(n)))}},w=-1,y=function(){return"hidden"===document.visibilityState?0:1/0},E=function(){p((function(e){var n=e.timeStamp;w=n}),!0)},b=function(){return w<0&&(w=y(),E(),g((function(){setTimeout((function(){w=y(),E()}),0)}))),{get firstHiddenTime(){return w}}},L=function(e,n){var t,i=b(),r=m("FCP"),a=function(e){"first-contentful-paint"===e.name&&(s&&s.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=e.startTime,r.entries.push(e),t(!0)))},o=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],s=o?null:v("paint",a);(o||s)&&(t=h(e,r,n),o&&a(o),g((function(i){r=m("FCP"),t=h(e,r,n),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,t(!0)}))}))})))},S=!1,T=-1,O={passive:!0,capture:!0},_=new Date,j=function(e,n){d||(d=n,u=e,f=new Date,R(removeEventListener),P())},P=function(){if(u>=0&&u<f-_){var e={entryType:"first-input",name:d.type,target:d.target,cancelable:d.cancelable,startTime:d.timeStamp,processingStart:d.timeStamp+u};l.forEach((function(n){n(e)})),l=[]}},k=function(e){if(e.cancelable){var n=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,n){var t=function(){j(e,n),r()},i=function(){r()},r=function(){removeEventListener("pointerup",t,O),removeEventListener("pointercancel",i,O)};addEventListener("pointerup",t,O),addEventListener("pointercancel",i,O)}(n,e):j(n,e)}},R=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(n){return e(n,k,O)}))},F={};function C(e,n=0){return+`${Math.round(`${e}e+${n}`)}e-${n}`}const I=(e,n,t=0)=>{e.value&&a({code:"PERF",message:"",perf:{[n]:C(e.value,t)}})};function D(){!function(e,n){S||(L((function(e){T=e.value})),S=!0);var t,i=function(n){T>-1&&e(n)},r=m("CLS",0),a=0,o=[],s=function(e){if(!e.hadRecentInput){var n=o[0],i=o[o.length-1];a&&e.startTime-i.startTime<1e3&&e.startTime-n.startTime<5e3?(a+=e.value,o.push(e)):(a=e.value,o=[e]),a>r.value&&(r.value=a,r.entries=o,t())}},c=v("layout-shift",s);c&&(t=h(i,r,n),p((function(){c.takeRecords().map(s),t(!0)})),g((function(){a=0,T=-1,r=m("CLS",0),t=h(i,r,n)})))}((e=>I(e,"cumulative_layout_shift",4))),function(e,n){var t,i=b(),r=m("FID"),a=function(e){e.startTime<i.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),t(!0))},o=v("first-input",a);t=h(e,r,n),o&&p((function(){o.takeRecords().map(a),o.disconnect()}),!0),o&&g((function(){var i;r=m("FID"),t=h(e,r,n),l=[],u=-1,d=null,R(addEventListener),i=a,l.push(i),P()}))}((e=>I(e,"first_input_delay"))),function(e,n){var t,i=b(),r=m("LCP"),a=function(e){var n=e.startTime;n<i.firstHiddenTime&&(r.value=n,r.entries.push(e)),t()},o=v("largest-contentful-paint",a);if(o){t=h(e,r,n);var s=function(){F[r.id]||(o.takeRecords().map(a),o.disconnect(),F[r.id]=!0,t(!0))};["keydown","click"].forEach((function(e){addEventListener(e,s,{once:!0,capture:!0})})),p(s,!0),g((function(i){r=m("LCP"),t=h(e,r,n),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,F[r.id]=!0,t(!0)}))}))}))}}((e=>I(e,"largest_contentful_paint"))),L((e=>I(e,"first_contentful_paint"))),function(e){var n,t=m("TTFB");n=function(){try{var n=performance.getEntriesByType("navigation")[0]||function(){var e=performance.timing,n={entryType:"navigation",startTime:0};for(var t in e)"navigationStart"!==t&&"toJSON"!==t&&(n[t]=Math.max(e[t]-e.navigationStart,0));return n}();if(t.value=t.delta=n.responseStart,t.value<0||t.value>performance.now())return;t.entries=[n],e(t)}catch(e){}},"complete"===document.readyState?setTimeout(n,0):addEventListener("pageshow",n)}((e=>I(e,"time_to_first_byte")))}let M,N=!1;function A(e,n){if(N!==!!e)if(N=!!e,N){if(Math.random()>=n)return;D(),M=function(){const e=function(){var e;const n=window.performance;if(!n)return null;const t=n.getEntriesByType("navigation")[0],i={},r={};if(t){const{requestStart:n,responseStart:a,responseEnd:o,domInteractive:s,domComplete:c,fetchStart:d}=t;Object.assign(r,{requestStart:n,responseStart:a,responseEnd:o,domInteractive:s,domComplete:c,navigationStart:d});const u=navigator;"undefined"!=typeof navigator&&Object.assign(r,{memory:u.deviceMemory,cpus:u.hardwareConcurrency,connection:null===(e=u.connection)||void 0===e?void 0:e.effectiveType}),o&&n&&(i.download_time=C(o-n)),a&&n&&(i.time_to_first_byte_naive=C(a-n)),c&&d&&(i.time_to_rendering=C(c-d)),s&&d&&(i.time_to_dom_interactive=C(s-d))}return window.performance.getEntriesByType("paint").forEach((({name:e,startTime:n})=>{"first-paint"===e&&(i.first_paint=C(n))})),{code:"PERF",message:"",perf:i,payload:r}}();e&&a(e)},window.addEventListener("beforeunload",M)}else window.removeEventListener("beforeunload",M)}function B(e){const{error:n,filename:t,lineno:i,colno:r}=e;a({message:`${(null==n?void 0:n.message)||n} at ${t}:${i}:${r}`,code:"UNHANDLED",stack:n?n.stack:void 0})}function $(e){const{reason:n}=e;a({message:null==n?void 0:n.message,code:"UNHANDLED_PROMISE",stack:null==n?void 0:n.stack,payload:{reason:n?JSON.stringify(n):void 0}})}let q=!1;function x(e){q!==!!e&&(q=!!e,q?(window.addEventListener("error",B),window.addEventListener("unhandledrejection",$)):(window.removeEventListener("error",B),window.removeEventListener("unhandledrejection",$)))}let H=0;function z(){setTimeout((()=>{H<30&&(H+=1,s(),z())}),12e4)}e.reasonsInit=function(e){const{trackClientPerf:r=!1,trackClientPerfRate:o=1,trackClientImgPerf:d=!0,trackImgError:u=!0,trackUnhandled:f=!0,service:l}=e;if(!l)throw new Error("Please provide service name for Reasons");!function(e){const{handler:r,service:a,details:o,payload:s}=e;i=Object.assign(Object.assign({},i),{handler:void 0!==r?r+(r.endsWith("/")?"":"/"):i.handler,service:a||i.service,details:Object.assign(Object.assign(Object.assign({},i.details),{url:window.location.href,reason_id:Math.floor(Math.random()*t+n).toString(36)}),o),payload:Object.assign(Object.assign({},i.payload),s)})}(e),x(f),A(r,o),c(d),function(e){if(!e)return;const n=[],t=[],i=document.querySelectorAll("img");i.forEach((e=>{e.addEventListener("error",(e=>{n.push(e.target.src)})),e.addEventListener("load",(e=>{t.push(e.target.src)}))})),window.addEventListener("beforeunload",(()=>{a({code:"PERF",message:"",perf:{imgs_errors:{total:i.length,error:n.length,loaded:t.length}}})}))}(u),window.addEventListener("load",s),window.addEventListener("load",z),window.addEventListener("beforeunload",s)},e.sendReason=a,e.trackUnhandledErrors=x,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=reasons.0.22.1.js.map